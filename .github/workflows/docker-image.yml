name: Release Manager

# ğŸŒŸ å…³é”®é…ç½®ï¼šä»…åœ¨ç”¨æˆ·æ¨é€ç‰¹å®šæ ¼å¼çš„ tag æ—¶è§¦å‘æµç¨‹
on:
  push:
    tags:
      - "v[0-9]+.[0-9]+.[0-9]*"  # åŒ¹é…æ ‡å‡†è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼Œä¾‹å¦‚ v1.0.0ã€v2.1.4

# ğŸš€ å¤š Job ç»„åˆå·¥ä½œæµï¼ˆæŒ‰éœ€æ‰©å±•ï¼‰
jobs:
  # ğŸ“¦ å‰ç½®æ„å»ºæ­¥éª¤ï¼ˆæ„å»ºå¯æ‰§è¡Œæ–‡ä»¶/å‹ç¼©åŒ…ç­‰ï¼‰
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      # âœ¨ æ›¿æ¢ä¸‹æ–¹æ­¥éª¤ä¸ºä½ å®é™…çš„æ„å»ºæµç¨‹ï¼ˆæ ¹æ®é¡¹ç›®éœ€æ±‚å®šåˆ¶ï¼‰
      - name: Build Project
        run: |
          echo "æ¨¡æ‹Ÿæ„å»ºè¿‡ç¨‹..."
          mkdir -p dist
          touch dist/app-${{ github.ref_name }}.zip  

  # ğŸ’« åˆ›å»º GitHub Release
  publish-release:
    needs: [build]  # ç¡®ä¿ build æ¨¡å—å…ˆè¿è¡Œ
    runs-on: ubuntu-latest  
    # ğŸ”’ åŒé‡ä¿é™©ï¼šä»…åœ¨ tag push æ—¶æ‰§è¡Œ
    if: startsWith(github.ref, 'refs/tags/')  
    steps:
      - name: Generate Changelog (å¯é€‰)
        run: |
          echo "# å˜æ›´æ—¥å¿—" > changelog.md
          git log $(git describe --tags --abbrev=0)...HEAD --oneline >> changelog.md  
          
      - name: Release the Version
        uses: softprops/action-gh-release@v1
        with:
          # âœ… æ­£ç¡®æŠ“å–æ ‡ç­¾åï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡ä¼˜åŒ–å¤„ç†ï¼‰
          tag_name: ${{ github.ref_name }}  
          name: "Release ${{ github.ref_name }}"  
          body_path: changelog.md  # æˆ–é™æ€æ–‡æ¡ˆï¼šbody: "æ­£å¼å‘å¸ƒ ${{ github.ref_name }}..." 
          files: |  # ğŸ“¤ ä¸Šä¼ æ„å»ºäº§ç‰©ï¼ˆæ ¹æ®å®é™…è·¯å¾„è°ƒæ•´ï¼‰
            dist/app-${{ github.ref_name }}.zip
          draft: false  # æ˜¯å¦ç”Ÿæˆè‰ç¨¿
          prerelease: ${{ contains(github.ref_name, '-beta') }}  # è‡ªåŠ¨è¯†åˆ«æ˜¯å¦é¢„å‘å¸ƒ                                
